import{initializeApp as M}from"https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";import{getFirestore as w,collection as v,getDocs as O}from"https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))m(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&m(l)}).observe(document,{childList:!0,subtree:!0});function b(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function m(e){if(e.ep)return;e.ep=!0;const r=b(e);fetch(e.href,r)}})();window.onload=()=>{const g=M({apiKey:"AIzaSyAKJ_MIyMk1dIgJYVYP25A2HSFQySsB04g",authDomain:"ccc-data-store.firebaseapp.com",projectId:"ccc-data-store",storageBucket:"ccc-data-store.appspot.com",messagingSenderId:"1084448372624",appId:"1:1084448372624:web:7461eb99124e29f9346515",measurementId:"G-YYC20JLCP7"}),b=w(g),m=v(b,"markers");async function e(){try{const s=await O(m),p=[];return s.forEach(d=>{p.push({id:d.id,...d.data()})}),console.log("Markers List:",p),console.log("Marker:",p[0].equipment),p}catch(s){return console.error("Error reading document: ",s),[]}}const r=document.querySelector("a-scene"),l=document.createElement("a-entity");l.setAttribute("cursor","rayOrigin: mouse; fuse: false;"),l.setAttribute("raycaster","objects: a-box, a-gltf-model"),l.setAttribute("raycaster","ignore: [canvas]"),l.setAttribute("raycaster","objects: .clickable; showLine: true;"),r.camera.el.appendChild(l);function f(s,p){function d(E){return E*Math.PI/180}const t=s[0],i=s[1],o=p[0],c=p[1],a=6371,u=c-i,n=d(u),A=o-t,h=d(A),y=Math.sin(n/2)*Math.sin(n/2)+Math.cos(d(i))*Math.cos(d(c))*Math.sin(h/2)*Math.sin(h/2),C=2*Math.atan2(Math.sqrt(y),Math.sqrt(1-y));return a*C}navigator.geolocation.getCurrentPosition(async s=>{(await e()).forEach((t,i)=>{const o=document.createElement("a-entity");o.setAttribute("gps-entity-place",`latitude: ${t.location.lat}; longitude: ${t.location.lng};`),o.setAttribute("look-at","[gps-camera]"),o.setAttribute("scale","6 6 6"),o.setAttribute("class","clickable"),o.setAttribute("id",`place-${i}`);const c=document.createElement("a-gltf-model");c.setAttribute("src","Shiny Amberis-Amur.glb"),c.setAttribute("scale","0.1 0.1 0.1"),c.setAttribute("look-at","[gps-camera]"),c.setAttribute("class","clickable"),o.appendChild(c);const a=document.createElement("a-text"),u=f([t.location.lng,t.location.lat],[s.coords.longitude,s.coords.latitude]).toFixed(2);a.setAttribute("value",`${t.equipment}
${u} km`),a.setAttribute("align","center"),a.setAttribute("position","0 1.5 0"),a.setAttribute("scale","1.5 1.5 1.5"),a.setAttribute("look-at","[gps-camera]"),o.appendChild(a);const n=document.createElement("a-box");n.setAttribute("class","clickable"),n.setAttribute("material","color: transparent; opacity: 0.0"),n.setAttribute("scale","2 2 0"),n.setAttribute("position","0 0 0"),o.appendChild(n),o.addEventListener("click",function(){console.log(`Clicked on ${t.equipment}`),d(t)}),r.appendChild(o)});function d(t){const i=document.createElement("div");i.setAttribute("id","landmark-modal"),Object.assign(i.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",backgroundColor:"rgba(255, 255, 255, 0.95)",zIndex:"9999",display:"flex",flexDirection:"column",alignItems:"stretch",justifyContent:"flex-start",padding:"20px",boxSizing:"border-box",fontFamily:"Arial, sans-serif",color:"#333"});const o=document.createElement("div");o.innerHTML="&times;",Object.assign(o.style,{position:"absolute",top:"20px",right:"20px",fontSize:"30px",cursor:"pointer",color:"#666",zIndex:"1"}),o.onclick=()=>document.body.removeChild(i),i.appendChild(o);const c=document.createElement("h2");c.innerText=t.equipment,Object.assign(c.style,{margin:"0",padding:"20px 0",color:"#2c3e50",fontSize:"24px",borderBottom:"2px solid #3498db",position:"sticky",top:"0"}),i.appendChild(c);const a=document.createElement("div");Object.assign(a.style,{flex:"1",overflowY:"auto",padding:"20px 0"}),i.appendChild(a);const u=document.createElement("div");u.innerHTML=`
            <p><strong>Operation:</strong> ${t.operation}</p>
            <p><strong>Control:</strong> ${t.control}</p>
            <p><strong>Control Framework:</strong> ${t.framework}</p>
            <p><strong>Operating Context:</strong> ${t.context}</p>
            <p><strong>Equipment:</strong> ${t.equipment}</p>
            <p><strong>Location</strong></br>
                &emsp;<strong>Lat:</strong> ${t.location.lat}</br>
                &emsp;<strong>Lng:</strong> ${t.location.lng}</p>
            <p><strong>Distance:</strong> ${f([t.location.lng,t.location.lat],[s.coords.longitude,s.coords.latitude]).toFixed(2)} km</p>
        `,Object.assign(u.style,{marginBottom:"20px",lineHeight:"1.6",fontSize:"16px"}),a.appendChild(u);const n=document.createElement("button");n.innerText="Perform CCC",Object.assign(n.style,{backgroundColor:"#3498db",color:"white",border:"none",padding:"12px 24px",borderRadius:"5px",cursor:"pointer",fontSize:"16px",transition:"background-color 0.3s",width:"100%",marginBottom:"20px"}),n.onmouseover=()=>n.style.backgroundColor="#2980b9",n.onmouseout=()=>n.style.backgroundColor="#3498db",n.onclick=()=>window.open(t.url,"_blank"),i.appendChild(n),document.body.appendChild(i)}},s=>{console.error("Error retrieving location",s)},{enableHighAccuracy:!0,maximumAge:0,timeout:27e3})};
